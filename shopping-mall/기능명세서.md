# 기능명세서

## 1. 개요

본 문서는 쇼핑몰 MVP 요구사항을 구현하기 위한 상세 기능 동작, 입력/출력, 예외 처리, 화면 구성을 정의한다.

---

## 2. 기능 상세

### 2.1 회원 관리

### 2.1.1 회원가입

**기능 설명:** 신규 사용자가 이메일 주소로 회원가입

**입력:**

- 이메일 (필수, 중복 불가)
- 비밀번호 (필수, 8자 이상)
- 비밀번호 확인 (필수)
- 이름 (필수)
- 휴대폰 번호 (선택)

**처리:**

1. 이메일 형식 및 공백 검증
2. 이메일 중복 확인
3. 비밀번호 유효성 검증
4. 비밀번호 암호화
5. 사용자 정보 DB 저장

**출력:**

- 성공: 회원가입 완료 메시지, 로그인 페이지로 이동
- 실패: 오류 메시지 표시

**검증 및 예외 처리 규칙:**

- 이메일은 `^\S+@\S+\.\S+$` 패턴을 만족해야 하며, 입력값은 `trim` 후 검사한다.
- 이메일은 사용자 컬렉션에서 유일해야 한다. 중복 시 "이미 사용 중인 이메일입니다" 메시지로 응답한다.
- 비밀번호는 8자 이상이며, 공백으로만 이루어진 문자열은 허용하지 않는다.
- 필수 입력(이메일/비밀번호/비밀번호 확인/이름)이 비어 있으면 "필수 정보를 입력해주세요" 메시지를 반환한다.
- 비밀번호와 비밀번호 확인이 다르면 "비밀번호가 일치하지 않습니다" 메시지와 함께 요청을 거절한다.
- 저장 전 비밀번호는 `bcrypt` 등 단방향 해시로 암호화한다.

---

### 2.1.2 로그인

**기능 설명:** 등록된 회원이 이메일과 비밀번호로 로그인

**입력:**

- 이메일
- 비밀번호

**처리:**

1. 이메일로 사용자 조회
2. 비밀번호 검증
3. 세션 또는 JWT 토큰 생성

**출력:**

- 성공: 메인 페이지로 이동
- 실패: "이메일 또는 비밀번호가 일치하지 않습니다"

**검증 및 예외 처리 규칙**

- 로그인 대상은 활성 사용자(탈퇴/차단 제외)로 제한한다.
- 비밀번호는 저장된 해시와 `bcrypt.compare`로 검증한다.
- 성공 시 JWT 또는 동등한 토큰을 발급하며, 토큰 만료 시간과 서명 키를 관리한다.
- 클라이언트는 로그인 성공 시 토큰과 사용자 프로필을 보안 스토리지(LocalStorage 등)에 저장하고, "아이디 저장" 선택 시 이메일을 별도로 보관한다.
- 인증 실패 시 "이메일 또는 비밀번호가 일치하지 않습니다" 메시지를 통일해 응답한다.
- 네트워크 오류 또는 서버 오류 시 "로그인 중 오류가 발생했습니다. 다시 시도해주세요." 메시지를 표시한다.

---

### 2.1.3 로그아웃

**기능 설명:** 로그인 상태를 종료하고 토큰을 무효화

**입력:** 없음 (현재 사용자 세션 기준)

**처리:**

1. 클라이언트: 로컬 저장소(LocalStorage 등)에 보관된 Access Token, 사용자 정보를 삭제한다.
2. 서버: Refresh Token 재발급용 쿠키를 초기화하고, DB에 저장된 Refresh Token 레코드를 삭제한다.
3. 서버는 성공 여부를 JSON으로 응답하고, 클라이언트는 로그인 페이지로 이동한다.

**출력:**

- 성공: "로그아웃되었습니다"와 같은 메시지
- 실패: 오류 메시지 (예: 토큰이 이미 삭제된 경우)

---

### 2.1.4 회원정보 수정

**기능 설명:** 로그인한 사용자가 자신의 정보를 수정

**입력:**

- 이름
- 휴대폰 번호

**처리:**

1. 로그인 상태 확인 및 사용자 식별
2. 입력값 유효성 검증(공백, 길이, 허용 문자 등)
3. DB 업데이트 및 수정 시간 기록

**출력:**

- 성공: "회원정보가 수정되었습니다"
- 실패: 오류 메시지

---

### 2.1.5 비밀번호 변경

**기능 설명:** 로그인한 사용자가 기존 비밀번호를 검증한 뒤 새 비밀번호로 교체

**입력:**

- 현재 비밀번호
- 새 비밀번호
- 새 비밀번호 확인

**처리:**

1. 로그인 상태 확인 및 사용자 식별
2. 현재 비밀번호와 저장된 해시 비교 (`bcrypt.compare`)
3. 새 비밀번호 유효성 검증(최소 길이, 공백 여부, 정책)
4. 새 비밀번호/확인 값 일치 여부 검증
5. 새 비밀번호 해시 저장 후 기존 Refresh Token 무효화(선택)

**출력:**

- 성공: "비밀번호가 변경되었습니다"
- 실패: 오류 메시지 (예: 현재 비밀번호 불일치, 정책 위반)

---

### 2.1.6 회원탈퇴

**기능 설명:** 사용자가 계정을 탈퇴(soft delete 권장)하고 인증 정보를 모두 해제

**입력:**

- 탈퇴 사유(선택)
- 비밀번호 재확인 또는 2차 인증(선택)

**처리:**

1. 로그인 상태 및 사용자 식별
2. 비밀번호 검증 또는 추가 인증(선택 요구사항)
3. `isDeleted` 플래그를 true로 설정하고, 개인정보 익명화 정책을 적용
4. 모든 Refresh Token 삭제 및 쿠키/LocalStorage 토큰 제거

**출력:**

- 성공: "회원탈퇴가 완료되었습니다"
- 실패: 오류 메시지 (예: 인증 실패)

---

### 2.2 상품 조회

### 2.2.1 상품 목록 조회

**기능 설명:** 카테고리별 또는 전체 상품 목록 조회

**입력:**

- 카테고리 ID (선택)
- 정렬 기준 (최신순/가격 낮은순/가격 높은순/인기순)
- 페이지 번호
- 페이지당 항목 수

**처리:**

1. 카테고리 필터 적용
2. 정렬 기준 적용
3. 페이징 처리
4. 상품 목록 조회

**출력:**

- 상품 목록 (썸네일, 이름, 가격, 재고 상태)
- 총 상품 수
- 페이지 정보

---

### 2.2.2 상품 상세 조회

**기능 설명:** 특정 상품의 상세 정보 조회

**입력:**

- 상품 ID

**처리:**

1. 상품 정보 조회
2. 상품 이미지 목록 조회
3. 리뷰 목록 조회 (최신순 5개)
4. 평균 평점 계산

**출력:**

- 상품명, 가격, 설명
- 상품 이미지 목록
- 재고 수량
- 평균 평점 및 리뷰 수
- 최근 리뷰

---

### 2.2.3 상품 검색

**기능 설명:** 키워드로 상품 검색

**입력:**

- 검색 키워드
- 정렬 기준
- 페이지 정보

**처리:**

1. 상품명에서 키워드 검색
2. 정렬 및 페이징 적용

**출력:**

- 검색 결과 상품 목록
- 검색 결과 수

---

### 2.3 장바구니

### 2.3.1 장바구니 추가

**기능 설명:** 상품을 장바구니에 추가

**입력:**

- 상품 ID
- 수량

**처리:**

1. 로그인 상태 확인
2. 재고 확인
3. 동일 상품이 장바구니에 있는지 확인
   - 있으면: 수량 증가
   - 없으면: 새로 추가

**출력:**

- 성공: "장바구니에 추가되었습니다"
- 실패: "재고가 부족합니다" 또는 오류 메시지

---

### 2.3.2 장바구니 조회

**기능 설명:** 현재 장바구니에 담긴 상품 목록 조회

**입력:**

- 없음 (로그인된 사용자 기준)

**처리:**

1. 로그인 상태 확인
2. 사용자의 장바구니 상품 조회
3. 총 금액 계산

**출력:**

- 장바구니 상품 목록 (상품명, 썸네일, 가격, 수량)
- 상품별 금액
- 총 금액

---

### 2.3.3 장바구니 수량 변경

**기능 설명:** 장바구니 상품의 수량 변경

**입력:**

- 장바구니 ID
- 변경할 수량

**처리:**

1. 재고 확인
2. 수량 업데이트

**출력:**

- 성공: 수량 변경 및 금액 재계산
- 실패: "재고가 부족합니다"

---

### 2.3.4 장바구니 삭제

**기능 설명:** 장바구니에서 상품 제거

**입력:**

- 장바구니 ID 또는 상품 ID

**처리:**

1. 해당 항목 삭제

**출력:**

- 성공: "삭제되었습니다"

---

### 2.4 주문 및 결제

### 2.4.1 주문서 작성

**기능 설명:** 구매할 상품의 주문서 작성

**입력:**

- 주문할 상품 목록 (장바구니에서 선택 또는 즉시 구매)
- 배송지 정보
  - 수령인 이름
  - 연락처
  - 우편번호
  - 주소
  - 상세주소
  - 배송 메모 (선택)
- 결제 수단

**처리:**

1. 로그인 상태 확인
2. 재고 확인
3. 주문 금액 계산
4. 임시 주문 정보 저장

**출력:**

- 주문 요약 정보
- 최종 결제 금액

---

### 2.4.2 결제 처리

**기능 설명:** 주문에 대한 결제 진행

**입력:**

- 주문 정보
- 결제 수단 정보

**처리:**

1. 결제 게이트웨이 연동
2. 결제 승인
3. 주문 상태 변경 (pending → paid)
4. 재고 차감
5. 주문번호 발급
6. 장바구니에서 주문 상품 제거

**출력:**

- 성공: 주문 완료 페이지, 주문번호 표시
- 실패: 결제 실패 메시지

**예외처리:**

- 재고 부족: "재고가 부족하여 주문할 수 없습니다"
- 결제 실패: "결제 처리 중 오류가 발생했습니다"

---

### 2.4.3 주문 내역 조회

**기능 설명:** 사용자의 주문 내역 조회

**입력:**

- 조회 기간 (선택)
- 주문 상태 필터 (선택)

**처리:**

1. 사용자의 주문 목록 조회
2. 필터 적용

**출력:**

- 주문 목록 (주문번호, 주문일, 상품명, 금액, 상태)

---

### 2.4.4 주문 상세 조회

**기능 설명:** 특정 주문의 상세 정보 조회

**입력:**

- 주문 ID

**처리:**

1. 주문 정보 조회
2. 주문 상품 목록 조회
3. 배송 정보 조회

**출력:**

- 주문번호, 주문일시
- 주문 상품 목록
- 배송지 정보
- 결제 정보
- 주문 상태

---

### 2.4.5 주문 취소

**기능 설명:** 배송 전 주문 취소

**입력:**

- 주문 ID
- 취소 사유 (선택)

**처리:**

1. 주문 상태 확인 (배송 전인지)
2. 결제 취소 처리
3. 재고 복구
4. 주문 상태 변경 (cancelled)

**출력:**

- 성공: "주문이 취소되었습니다"
- 실패: "배송이 시작되어 취소할 수 없습니다"

---

### 2.5 리뷰

### 2.5.1 리뷰 작성

**기능 설명:** 구매 확정된 상품에 대한 리뷰 작성

**입력:**

- 주문 상품 ID
- 별점 (1-5점)
- 리뷰 내용
- 이미지 (선택, 최대 5장)

**처리:**

1. 구매 이력 확인
2. 리뷰 작성 가능 여부 확인 (이미 작성했는지)
3. 리뷰 저장
4. 이미지 업로드 및 저장

**출력:**

- 성공: "리뷰가 등록되었습니다"
- 실패: 오류 메시지

**예외처리:**

- 구매 이력 없음: "구매한 상품만 리뷰를 작성할 수 있습니다"
- 중복 리뷰: "이미 리뷰를 작성하셨습니다"

---

### 2.5.2 리뷰 조회

**기능 설명:** 상품별 리뷰 목록 조회

**입력:**

- 상품 ID
- 정렬 기준 (최신순/별점 높은순/별점 낮은순)
- 페이지 정보

**처리:**

1. 상품의 리뷰 목록 조회
2. 정렬 및 페이징 적용

**출력:**

- 리뷰 목록 (작성자, 별점, 내용, 이미지, 작성일)
- 평균 평점
- 총 리뷰 수

---

### 2.5.3 리뷰 수정/삭제

**기능 설명:** 자신이 작성한 리뷰 수정 또는 삭제

**입력:**

- 리뷰 ID
- 수정할 내용 (수정 시)

**처리:**

1. 작성자 확인
2. 리뷰 수정 또는 삭제

**출력:**

- 성공: "리뷰가 수정/삭제되었습니다"
- 실패: "권한이 없습니다"

---

### 2.6 관리자 기능

### 2.6.1 상품 관리

**기능 설명:** 상품 등록, 수정, 삭제

**입력:**

- 상품명
- 카테고리
- 가격
- 재고 수량
- 상품 설명
- 이미지 (여러 장)
- 상태 (판매중/판매중지/품절)

**처리:**

1. 관리자 권한 확인
2. 입력값 유효성 검증
3. 상품 정보 저장
4. 이미지 업로드 및 저장

**출력:**

- 성공: "상품이 등록/수정/삭제되었습니다"

---

### 2.6.2 주문 관리

**기능 설명:** 주문 목록 조회 및 배송 상태 변경

**입력:**

- 조회 조건 (날짜, 상태 등)
- 주문 ID
- 변경할 배송 상태

**처리:**

1. 관리자 권한 확인
2. 주문 목록 조회 또는 상태 변경

**출력:**

- 주문 목록 및 상세 정보
- 상태 변경 완료 메시지

---

### 2.6.3 카테고리 관리

**기능 설명:** 카테고리 추가, 수정, 삭제

**입력:**

- 카테고리명
- 상위 카테고리 (선택)
- 정렬 순서

**처리:**

1. 관리자 권한 확인
2. 카테고리 저장/수정/삭제

**출력:**

- 성공: "카테고리가 등록/수정/삭제되었습니다"

---

## 3. 화면 구성

### 3.1 사용자 화면

1. **메인 페이지**: 추천 상품, 카테고리, 인기 상품
2. **상품 목록 페이지**: 카테고리별/검색 결과 상품 목록
3. **상품 상세 페이지**: 상품 정보, 리뷰, 구매 버튼
4. **장바구니 페이지**: 장바구니 상품 목록, 주문하기
5. **주문서 페이지**: 배송지 입력, 결제 수단 선택
6. **주문 완료 페이지**: 주문번호, 주문 정보
7. **마이페이지**: 주문 내역, 회원정보, 리뷰 관리, 배송지 관리
8. **로그인/회원가입 페이지**

### 3.2 관리자 화면

1. **대시보드**: 매출 현황, 주문 현황
2. **상품 관리**: 상품 목록, 등록/수정/삭제
3. **주문 관리**: 주문 목록, 배송 상태 관리
4. **카테고리 관리**: 카테고리 목록, 등록/수정/삭제
5. **회원 관리**: 회원 목록 조회

---
